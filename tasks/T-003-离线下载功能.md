# T-003: Novel 离线下载功能

## 目标
为 Novel 项目添加章节离线下载功能

## 功能需求 ✅

### 方案A: 打包下载（已实现）
**支持格式**:
- [x] .txt - 纯文本格式，最通用
- [ ] .epub - 电子书格式，支持目录（后续迭代）
- [ ] .pdf - PDF格式，适合打印（后续迭代）

**实现方式**:
- 前端 JS 打包生成文件
- 使用 Blob + URL.createObjectURL

**交互**:
- [x] 批量下载：支持选择章节范围下载
- [ ] 单章下载（后续迭代）
- [ ] 全书下载（后续迭代）

## 技术方案 ✅

### 前端实现（纯前端方案）
```typescript
// 批量下载章节
async function downloadChapters(start: number, end: number) {
  const chapters = await fetchChapters(start, end)
  let content = `${novelTitle}\n\n`
  
  chapters.forEach(ch => {
    content += `${ch.title}\n\n${ch.content}\n\n`
  })
  
  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = `${novelTitle}_第${start}-${end}章.txt`
  a.click()
  URL.revokeObjectURL(url)
}
```

**无需额外依赖库** - 纯 JS 实现

## UI 设计 ✅

### 下载入口
- 位置：底部工具栏下载按钮（⬇️）
- 点击打开底部抽屉弹窗

### 下载弹窗（移动端底部面板）
```
━━━━━━━━━━━━━━━━━
批量下载
━━━━━━━━━━━━━━━━━
从: [第 001 章 ▼]
到: [第 225 章 ▼]

已选择: 225 章
预计大小: 约 500KB

[取消]    [下载]
━━━━━━━━━━━━━━━━━
```

## 验收标准
- [x] 支持批量选择章节下载
- [x] 下载文件名包含章节信息
- [x] 进度提示（批量下载时）
- [x] 移动端适配
- [x] Git提交推送
- [x] 部署验证

## 进度
| 时间 | 事件 | 状态 |
|:---:|:---|:---:|
| 2026-02-22 | Task 创建 | ✅ |
| 2026-02-22 | 功能开发 | ✅ |
| 2026-02-22 | Git 提交: 3e52cd1 | ✅ |

## 提交记录
- 3e52cd1 feat: 移动端批量下载功能

## 使用方法
1. 打开任意小说阅读页面
2. 点击底部工具栏的 ⬇️ 下载按钮
3. 选择要下载的章节范围（从/到）
4. 点击下载，自动打包为 TXT
5. 文件保存到手机，可离线阅读
