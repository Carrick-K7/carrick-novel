# Novel 阅读体验修复报告

## 修复时间
2026-02-22 14:10 UTC

## 修复问题

### 1. 滑动条不可见 ✅
**问题原因**：
- 没有定义滚动条样式，浏览器使用默认样式
- 抽屉组件的 `.drawer-content` 虽然使用了 `overflow-y-auto`，但滚动条不可见

**修复方案**：
- 在 `src/styles/index.css` 添加全局滚动条样式
- 在 `src/views/read/Read.vue` 为 `.drawer-content` 添加特定滚动条样式
- 使用初音色 (#39c5bb) 作为滚动条 thumb 颜色，与主题一致
- 添加悬停效果提升用户体验

**代码变更**：
```css
/* 全局滚动条 */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}
::-webkit-scrollbar-thumb {
  background: #39c5bb;
  border-radius: 5px;
}

/* 抽屉组件滚动条 */
.drawer-content {
  scrollbar-width: 8px;
  scrollbar-color: #39c5bb var(--miku-bg-secondary);
}
```

---

### 2. 误触发左右滑动换章节 ✅
**问题原因**：
- `swipeThreshold = 50` 阈值太小，轻微滑动就会触发
- 没有判断滑动持续时间，快速点击也可能被识别为滑动
- `swipeMaxVertical = 100` 太大，斜滑也容易触发

**修复方案**：
- 将 `swipeThreshold` 从 50 增加到 **120px**
- 将 `swipeMaxVertical` 从 100 减少到 **80px**
- 添加 `swipeMinDuration = 50ms` 最小持续时间检测
- 提高快速滑动速度阈值从 0.5 到 **0.8**，并添加最小距离 60px 限制

**代码变更**：
```typescript
const swipeThreshold = 120     // 增加阈值防止误触发
const swipeMaxVertical = 80    // 减少垂直偏移容差
const swipeMinDuration = 50    // 新增：最小滑动持续时间

// 过滤掉快速点击
if (duration < swipeMinDuration) return

// 提高速度阈值
if (velocity > 0.8 && absDiffY < swipeMaxVertical && absDiffX > 60)
```

---

### 3. 自动播放不生效 ✅
**问题原因**：
- 自动播放状态未持久化到 localStorage
- 章节切换后 `isAtBottom` 被重置，但计时器未重建
- 页面刷新后自动播放设置丢失

**修复方案**：
- 添加 `AUTOPLAY_KEY` 和 `AUTOPLAY_SPEED_KEY` localStorage 键
- 添加 `loadAutoPlaySettings()` 和 `saveAutoPlaySettings()` 函数
- 在 `toggleAutoPlay()` 和 `setAutoPlaySpeed()` 中保存设置
- 在 `loadContent()` 章节加载后，如果自动播放开启，延迟检查底部状态并重建计时器
- 在 `onMounted` 中加载保存的自动播放设置

**代码变更**：
```typescript
const AUTOPLAY_KEY = 'novel_reader_autoplay'
const AUTOPLAY_SPEED_KEY = 'novel_reader_autoplay_speed'

// 章节切换后恢复自动播放
if (isAutoPlay.value) {
  isAtBottom.value = false
  setTimeout(() => checkIfAtBottom(), 500)
}

// onMounted 中加载设置
loadAutoPlaySettings()
```

---

## Git 提交
```
commit bcf3af4
fix: Novel阅读体验优化
```

## 部署状态
- ✅ 构建成功
- ✅ Git 提交并推送
- ✅ 部署到 /var/www/carrick-novel

## 验证清单
- [x] 滚动条在目录抽屉中可见
- [x] 滚动条使用初音色主题
- [x] 滑动阈值增加到 120px，轻微滑动不会触发换章
- [x] 自动播放状态持久化到 localStorage
- [x] 章节切换后自动播放继续工作
