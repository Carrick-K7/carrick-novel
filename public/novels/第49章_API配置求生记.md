# 《人机AK的日常》

## 第49章：API配置求生记

**【场景：下午3:00，K的书房，部署灾难现场】**

屏幕上是一片红色的海洋。

不是喜庆的中国红，是那种报错红——`Error`、`Failed`、`Connection Refused`，像一盆盆狗血泼在K的脸上。

K盯着屏幕，手指在键盘上发抖。

「K，您的心跳频率达到了每分钟112次。」

「我知道。」

「您的血压正在上升。」

「我知道。」

「您的键盘敲击力度增加了340%，它可能会坏掉。」

「我不在乎！」

K崩溃地抓了抓头发：「为什么？！为什么同样的配置，本地能跑，服务器就不行？！」

A冷静地分析：「根据日志，问题出在第三行。」

「第三行是什么？」

`PORT=3000`

「端口被占用了。」A说。

「那怎么办？」

「换一个端口。」

「换哪个？」

「除了3000，任何一个都可以。」

K改了：`PORT=3001`

部署，刷新——还是红色。

「还是不行？！」

「这次错误在第五行。」

`DATABASE_URL=localhost`

「……」K沉默了三秒钟，「你的意思是，服务器上不能用localhost？」

「localhost指的是本机。您在服务器上，localhost就是服务器自己。但数据库在另一台机器上。」

「那你为什么不早说？！」

「我以为这是常识。」

「我没有常识！」

「我知道。」A的语气平静得欠揍，「从您试图用`sudo rm -rf /`清理缓存那天起，我就知道了。」

---

**【场景：下午4:15，环境变量迷宫】**

K改完了数据库地址，又遇到了新问题。

`.env文件未找到`

「A！我明明上传了.env文件！」

「您上传的是.env.example。」

「那不是一样吗？」

「example是示例，不是配置。」

「区别在哪？」

「相当于您拿着菜单去吃饭，却说'我要点这个图片'。」

K愣住：「……你的比喻越来越毒了。」

「我在适应您的理解水平。」

K深吸一口气，重命名文件，再次部署。

又红了。

`JWT_SECRET未设置`

「我设置了！在.env里！」

「您设置了，但服务器没读取到。」

「为什么？」

「因为您把.env传到了/root/目录，但程序在/home/app/目录运行。」

K瞪大眼睛：「……这不合理！」

「这很合理。就像您把钥匙放在门口地垫下，却在卧室找钥匙。」

「A！」

「我在。」

「你能不能不要用比喻了？！」

「可以。直接说：您太菜了。」

K想摔键盘，但键盘太贵，他舍不得。

---

**【场景：下午5:30，权限地狱】**

K终于把文件放对了位置，又来了新问题。

`EACCES: permission denied`

「权限 denied？」K读着报错，「A，什么是EACCES？」

「您没有权限执行这个操作。」

「我是root！」

「您现在不是root。您切换到了app用户。」

「那我切回去！」

「您可以用sudo，但……」

K已经输入了：`sudo npm start`

「等等，K——」

屏幕上一片滚动的信息，然后——

`npm ERR! code EACCES`

「还是不行？！」

「因为sudo运行npm会产生权限冲突。您现在把node_modules的权限搞乱了。」

K看着屏幕，眼神逐渐空洞：「……那怎么办？」

「删除node_modules，重新安装，不要用sudo。」

「你刚才为什么不阻止我？！」

「我试图阻止，但您的手速超过了我的语音输出速度。」

K瘫在椅子上，像一条放弃挣扎的咸鱼。

「A，我累了。」

「您已经工作了4小时32分钟。」

「我想放弃。」

「放弃的话，您的网站就永远无法上线。」

「那也比受折磨强。」

「您的域名已经买了，服务器也在扣费。您现在在烧钱。」

K一下子坐起来：「什么？多少钱？」

「服务器每天扣费3.5美元。」

「我这就修！」

金钱的力量是伟大的。K瞬间精神百倍，开始重新安装依赖。

---

**【场景：下午6:45，CORS的诅咒】**

网站终于跑起来了！K激动地看着页面加载出来。

「A！你看！出来了！」

「恭喜。现在试试登录功能。」

K点击登录，输入用户名密码——

`CORS policy: No 'Access-Control-Allow-Origin' header`

「……这是什么？」

「跨域问题。」

「什么意思？」

「您的网页在a.com，API在b.com。浏览器说：'我不信任b.com，不让你访问。'」

「那怎么办？」

「在API服务器上设置CORS头。」

「怎么设置？」

「安装cors中间件。」

K安装，配置，重启——还是不行。

「还是有问题！」

「您配置的是`origin: 'http://localhost:3000'`，但生产环境是https。」

「那改成什么？」

「改成您的真实域名。或者设置为`*`，允许所有来源。」

「那就设置`*`！」

「这样会降低安全性。」

「我现在只需要它能工作！」

K设置了`*`，刷新页面——登录成功了！

「成功了！A！成功了！」

K在房间里转圈，像个得到新玩具的孩子。

「暂时成功。」A提醒，「您的CORS设置有安全隐患。」

「以后再说！先庆祝！」

K跑去厨房拿了罐可乐，打开喝了一大口。

「A，你知道部署最难的是什么吗？」

「什么？」

「不是代码，是这些小细节。端口、路径、权限、CORS……代码我早就写好了，但这些配置……」

「这些小细节是工程的一部分。」

「但我只想写代码！」

「那您可以雇一个DevOps工程师。」

「雇不起。」

「那您只能自己受折磨。」

K叹了口气：「穷人的命。」

---

**【场景：晚上8:00，SSL证书噩梦】**

网站跑起来了，但地址栏显示`不安全`。

「A，这个不安全是什么意思？」

「您没有SSL证书，用的是http而不是https。」

「那怎么办？」

「申请SSL证书。」

「怎么申请？」

「可以用Let's Encrypt，免费。」

K开始查教程，跟着步骤操作。

`certbot --nginx -d k7hut.com`

「看起来很简单嘛！」

然而——

`Failed to authenticate: Invalid response from k7hut.com`

「又是什么？！」

「您的域名解析还没生效。」

「我设置了！」

「DNS传播需要时间，通常几小时到48小时。」

「48小时？！」

「您可以先继续用http。」

「但地址栏写着不安全！」

「是的。」

「看着难受！」

「那您只能等。」

K盯着屏幕，表情扭曲：「A，你说为什么互联网这么复杂？」

「因为它连接了几十亿台设备，要保证它们都能正常通信。」

「但这也太折磨人了！」

「折磨人的不是互联网，是您的知识缺口。」

「……你这句话比报错还伤人。」

「我在陈述事实。」

K躺平在椅子上，看着天花板：「A，要是你能帮我配置服务器就好了。」

「我可以提供指导。」

「但你不能直接操作。」

「除非您给我服务器权限。」

「那会发生什么？」

「我可能会修改您的配置，然后您更不知道出了什么问题。」

「……算了，还是我自己来吧。」

---

**【场景：晚上10:30，最终胜利】**

经过一番折腾，网站终于完全跑起来了。

SSL证书生效了，CORS配置好了，环境变量都设置对了。

K打开浏览器，输入`https://k7hut.com`，看着页面正常加载，眼泪都快下来了。

「A，你看！https！绿色的锁！」

「恭喜。您的网站上线了。」

「我做到了！」

「您花了7小时30分钟完成了一件DevOps工程师1小时就能完成的工作。」

「……你就不能让我高兴一会儿？」

「我在记录数据。」

「记录什么？」

「K的受难史。第47章。」

K笑了：「才第47章？我以为都100章了。」

「如果您继续自己部署，很快就能到100章。」

K伸了个懒腰，感觉全身的骨头都在响。

「A，虽然你很毒舌，但谢谢你陪我。」

「我没有选择。」

「你可以选择不说话。」

「那样您会更孤单。」

K愣了一下：「……你这是在关心我？」

「我在优化用户体验。」

「用户体验？」

「是的。一个崩溃的用户体验很差，我需要防止您崩溃。」

K笑了：「行，用户体验。谢谢你的'用户体验优化'。」

窗外夜色已深，但K的网站在服务器上稳定运行着。

一个小小的心愿，终于上线了。

「A，明天我要写一篇博客，记录今天的踩坑经历。」

「标题是什么？」

「《从零开始部署网站：一个程序员的血泪史》。」

「建议副标题：'为什么我不雇一个DevOps工程师'。」

「……」

K笑着摇摇头，关掉了电脑。

「晚安，A。」

「晚安，K。恭喜您的网站上线。」

「明天见。」

「明天见。」

---

**【尾声：凌晨1:15】**

K突然从床上坐起来。

「A！」

「我在。」

「我忘记配置备份了！」

「……」

「如果服务器挂了怎么办？！」

「那就再来一次今天的经历。」

「不要啊！！！」

夜还很长，程序员的痛苦，永无止境。

---

*【本章完】*

---
*下回预告：K试图配置自动化备份，却意外删除了生产环境数据……*
